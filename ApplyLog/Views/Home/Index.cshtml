@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@model Tuple<List<TODO>, List<Bewerbung>>
@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Welcome to ApplyLog</h1>
</div>
    <div class="text-left">
        <ul>
            <li>Here, you can easily keep track of your job search journey.</li>
            <li>Save your job applications, search through them by company name, and see where you've applied on the Germany map. </li>
            <li>Create your own to-do list with priorities to stay organized.</li>
            <li>Check out your progress in colorful charts showing your application locations and your to-do priorities. </li>
            <li>Ready to get started? You can also search for new job offers directly — just click "Search Jobs" in the menu!</li>
        </ul>
    </div>
    <hr />
    <form asp-action="Search" asp-controller="Home" data-ajax="true" data-ajax-update="#result" data-ajax-method="GET" data-ajax-mode="replace" id="formSearch">
        <input type="search" id="search" name="search" class="form-control m-tb" placeholder="Search something" onkeyup="searchDBFull();"/>
    </form>
   <div id="result">
   </div>
   <div class="row">
       <div class="col-md-6">
        <span class="fw-bold">Applications: @ViewBag.Applications</span>
        @if (Model.Item2.Count == 0)
        {
            <p>No Applications!</p>
        }
        else
        {
            <div class="p-1">
            </div>
            <table class="table border">
                @foreach (var app in Model.Item2)
                {
                    <tr>
                        <td class="text-start"><a asp-controller="Application" asp-action="View" asp-route-id="@app.Id" title="View Job Application">@app.Position ( @app.Firma.CompanyName )</a></td>
                        <td class="text-end">
                            <a asp-controller="Application" asp-action="Edit" asp-route-id="@app.Id" title="Edit Job Application"><i class="bi bi-pencil-square fs-5"></i></a>
                        </td>
                    </tr>
                }
            </table>
        }
       </div>
       <div class="col-md-6">
        <span class="fw-bold">TODOs: @ViewBag.TODOs</span>
        @if (Model.Item1.Count == 0)
        {
            <p>No TODOs!</p>
        }
        else
        {
            <div class="p-1">
            </div>
            <table class="table border">
                @foreach (var todo in Model.Item1)
                {
                    <tr>
                        <td class="text-start">
                            @if (todo.PriorityLevel == PriorityLevel.High)
                            {
                                <span>❗</span>
                            }
                            <a asp-controller="Todo" asp-action="View" asp-route-id="@todo.ID" title="View todo @todo.Titel">
                            @todo.Titel
                            </a>
                        </td>
                        <td class="text-end">
                            <a asp-controller="Todo" asp-action="Edit" asp-route-id="@todo.ID" title="Edit todo"><i class="bi bi-pencil-square fs-5"></i></a>
                        </td>
                    </tr>
                }
            </table>
        }
       </div>
   </div>
    <hr />
    @if(SignInManager.IsSignedIn(User)){
    <div class="row">
        <div class="col-lg-6">
            <h2>Applications GeoChart</h2>
            <div id="chartContainer2">GeoDiagram Loading</div>
        </div>
        <div class="col-lg-6">
            <h2>TODO Priority</h2>
            <div id="chartContainer">Diagram Loading</div>
        </div>
        <tr>
    </div>
    }
<script>
    $(function (){
        $("#chartContainer2").load("/Home/GeoChart");
    });
    $(function (){
        $("#chartContainer").load("/Home/TodoData");
    });
    function searchDBFull(){
        $("#formSearch").submit();
    }
</script>
